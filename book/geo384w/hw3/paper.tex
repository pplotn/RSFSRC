\author{Pierre de Fermat} 
%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Homework 3}

\begin{abstract}
  This homework has two parts. In the theoretical part, you will
derive the geometrical amplitude of the acoustic displacement and
reflection traveltimes from a plane reflector. In the
computational part, you will experiment with imaging a synthetic
dataset and a field dataset from the Gulf of Mexico.
\end{abstract}

Completing the computational part of this homework assignment requires
\begin{itemize}
\item \texttt{Madagascar} software environment available from \\
  \url{http://www.ahay.org}
\item \LaTeX\ environment with \texttt{SEGTeX} available from \\ 
  \url{http://www.ahay.org/wiki/SEGTeX}
\end{itemize}

You are welcome to do the assignment on your personal computer by
installing the required environments. In this case, you can obtain all
homework assignments from the \texttt{Madagascar} repository by running
\begin{verbatim}
svn co https://github.com/ahay/src/trunk/book/geo384w/hw3
\end{verbatim}

\section{Theoretical part}
\inputdir{XFig}

\begin{enumerate}

\item In class, we derived the following acoustic wave equation for
  pressure $P(\mathbf{x},t)$:
\begin{equation}
{\frac{1}{V^2(\mathbf{x})}}\,{\frac{\partial^2 P}{\partial t^2}} =\nabla^2 P + 
\rho(\mathbf{x})\,
\nabla\left(\frac{1}{\rho(\mathbf{x})}\right) \cdot \nabla P\;.
\label{eq:pwave}
\end{equation}
\begin{enumerate}
\item Using the connection between the pressure and displacement, derive the
acoustic wave equation for the displacement vector
$\mathbf{u}(\mathbf{x},t)$:
\begin{equation}
  \label{eq:uwave}
  \rho(\mathbf{x})\,\frac{\partial^2 \mathbf{u}}{\partial t^2} =
\end{equation}

\item Consider a geometrical wave representation in the vicinity of a wavefront
\begin{equation}
  {\mathbf{u}(\mathbf{x},t)} = \mathbf{a}(\mathbf{x})\,f\left(t-T(\mathbf{x})\right)
  \label{eq:gwave}
\end{equation}
and derive partial differential equations for the traveltime function
$T(\mathbf{x})$ and the vector amplitude $\mathbf{a}(\mathbf{x})$.

\item Assuming that the geometrical wave propagates in the direction
  of the traveltime gradient
\begin{equation}
  {\mathbf{a}(\mathbf{x})} = A(\mathbf{x})\,V(\mathbf{x})\,\nabla T
  \label{eq:vamp}
\end{equation}
show that the amplitude continuation along a ray is given by equation 
\begin{equation}
  \label{eq:avj}
  \left|\mathbf{a}_1\right| = \left|\mathbf{a}_0\right|\,
  \left(\frac{\rho_0\,V_0\,J_0}{\rho_1\,V_1\,J_1}\right)^{1/2}\;, 
\end{equation}
where $J_0$ and $J_1$ are the corresponding geometrical spreading factors.

\end{enumerate}

\item Consider a medium with a constant gradient of slowness squared
  \begin{equation}
    S^2(\mathbf{x}) = S_0^2 + 2\,\mathbf{g} \cdot (\mathbf{x}-\mathbf{x}_0)\;.
  \end{equation}
\begin{enumerate}
\item In the 2-D case, the ray-family coordinate system can be
  specified by $\mathbf{r}=\{\sigma,\theta\}$, where $\sigma$ goes
  along the ray, and $\theta$ is the initial ray angle. A family of
  rays starts from the source point $\mathbf{x}_0$, with each ray
  traveling in the direction $\mathbf{p_0} =
  \{S_0\,\cos{\theta},S_0\,\sin{\theta}\}$. Show that the coordinate
  transformation matrix $\mathbf{P}=\partial \mathbf{p}/\partial
  \mathbf{r}$ changes along the ray as
  \begin{equation}
    \label{eq:p}
    \mathbf{P}(\sigma) = \left[\begin{array}{cc} 
        g_1 & -S_0\,\sin{\theta} \\
        g_2 & S_0\,\cos{\theta} \end{array}\right]\;,
  \end{equation}
  where $g_1$ and $g_2$ are the components of $\mathbf{g}$ and find
  the corresponding transformation of matrices
  $\mathbf{X}=\partial \mathbf{x}/\partial \mathbf{r}$ and
  $\mathbf{K}=\mathbf{P}\,\mathbf{X}^{-1}$.
  \begin{eqnarray}
    \label{eq:x}
    \mathbf{X}(\sigma)  & = & \\ 
    \mathbf{K}(\sigma)  & = & 
    \label{eq:k}
    \end{eqnarray}

  \end{enumerate}

\item Consider the source point $s$ and the receiver point $r$ at the
  surface $z=0$ above a 2-D constant-velocity medium and a curved
  reflector defined by the equation $z = z(x)$ with a twice
  differentiable function $z(x)$ (Figure~\ref{fig:curve}).

  \plot{curve}{width=0.7\textwidth}{Geometry of reflection in a
    constant-velocity medium with a curved reflector.}

  Note that the two-point ray trajectory can be parametrized by the
  reflection point $y$ with the following expression for the
  reflection traveltime (using the Pythagoras theorem):
  \begin{equation}
      T(s,r) = {\frac{\sqrt{(s-y)^2+z^2(y)}+\sqrt{(r-y)^2+z^2(y)}}{V}}\;.
      \label{eq:dsr}
  \end{equation}

  \begin{enumerate}
  \item Apply Fermat's principle to specify $F(y)$ in the equation
    \begin{equation}
	\label{eq:fermat}
	    F(y) = 0
      \end{equation}
      required for finding the reflection point $y$.

    \item Newton's method (successive linearization) solves nonlinear
    equations like~(\ref{eq:fermat}) iteratively by starting with some
    $y_0$ and repeating the iteration
      \begin{equation}
      \label{eq:newton}
        y_{n+1} = y_n - \frac{F(y_n)}{F'(y_n)}
      \end{equation}
      for $n=0,1,2,\ldots$ 

      Specify $F'(y)$ for the problem of finding the reflection point.

    \item Consider the special case of a dipping-plane reflector 
\begin{equation}
\label{eq:plane}
z(x) = x\,\tan{\alpha}\;,
\end{equation}
 where $\alpha$ is the dip angle. Show that, in
    this case, equation~(\ref{eq:fermat}) reduces to a linear equation
    for $y$. Find $y$ and substitute it into~(\ref{eq:dsr}) to define the 
    reflection traveltime analytically.

\item (EXTRA CREDIT) Find the reflection traveltime for a circle reflector
\begin{equation}
\label{eq:circle}
z(x) = \sqrt{R^2 - (x-x_0)^2}\;.
\end{equation}

\end{enumerate}
\end{enumerate}

\section{Computational part}

\begin{enumerate}
\item In the first part, you will experiment with creating and 
  imaging a synthetic seismic reflection dataset.

  \inputdir{synth}

 \plot{data}{width=0.9\textwidth}{2-D synthetic data.}
  \sideplot{model}{width=\textwidth}{(a) Synthetic model: curved
    reflectors in a $V(z)$ velocity.}
  \plot{vscan}{width=0.9\textwidth}{Velocity semblance scan.}
  \plot{vnmo}{width=0.9\textwidth}{RMS velocity (a) and picked NMO velocity (b).}
  \multiplot{2}{dstack,zoff}{width=0.45\textwidth}{(a) DMO stack. (b)
    Zero-offset section.}
  \plot{tmig}{width=0.9\textwidth}{Kirchhoff poststack time
    migration.}
  \sideplot{dmig2}{width=\textwidth}{Time migration converted to depth, with reflectors overlaid.}

Figure~\ref{fig:data} shows a synthetic reflection dataset computed
from a reflector model shown in Figure~\ref{fig:model} and assuming a
velocity model with a constant vertical gradient $V(z) = 1.5 +
0.36\,z$. A small amount of random noise is added to the synthetic data.

Figure~\ref{fig:vscan} shows a conventional velocity semblance
scan. Figure~\ref{fig:vnmo} compares the RMS velocity with the NMO
velocity picked from the scan. Figure~\ref{fig:dstack,zoff} compares a
DMO stack and the zero-offset section from the data. Finally,
Figures~\ref{fig:tmig} and~\ref{fig:dmig2} show the result of
Kirchhoff time migration before and after conversion from time to
depth.

\begin{enumerate}
\item Change directory 
\begin{verbatim}
cd hw3/synth
\end{verbatim}
\item Run
\begin{verbatim}
scons view
\end{verbatim}
to generate the figures and display them on your screen.
If you are on a computer with multiple CPUs, you
can also try
\begin{verbatim}
pscons view
\end{verbatim}
to run certain computations in parallel.
\item Explain the cause of the difference between the RMS velocity and the NMO velocity in Figure~\ref{fig:vnmo}.
\item Edit the \texttt{SConstruct} file to switch on the antialiasing parameter in Kirchhoff migration 
(by changing it from 0 to 1). Generate the migration figures again. What differences do you observe?
\item Edit the \texttt{kirchhoff.c} file to improve the result of migration. This task is open-ended. 
The change is up to you, as long as you can achieve an improvement. Possible options:
\begin{itemize}
\item Use a more accurate traveltime computation.
\item Introduce an amplitude weight.
\item Change from time to depth migration (you can assume a locally $V(z)$ medium and use results from Homework~2.)
\item Change from poststack to prestack migration.
\end{itemize}
\item The processing flow in the \texttt{SConstruct} file involves some cheating: the exact 
depth velocity and the exact RMS velocity are used without being
estimated from the data. Modify the processing flow so that only
properties estimated from the data get used. This task is open-ended
as well, different data processing strategies are possible.
\end{enumerate}

\lstset{language=python,numbers=left,numberstyle=\tiny,showstringspaces=false}
\lstinputlisting[frame=single]{synth/SConstruct}

\lstset{language=c,numbers=left,numberstyle=\tiny,showstringspaces=false}
\lstinputlisting[frame=single]{synth/kirchhoff.c}

\inputdir{gulf}
\plot{gulf}{width=0.8\textwidth}{2-D field dataset from the Gulf of Mexico.}

\newpage

\item In the second part of the computational assignment, you will use the processing strategy developed for synthetic data 
to process a 2-D field dataset from the Gulf of Mexico, shown in Figure~\ref{fig:gulf}.

\begin{enumerate}
\item Change directory 
\begin{verbatim}
cd hw3/gulf
\end{verbatim}
\item Run
\begin{verbatim}
scons view
\end{verbatim}
to generate the figures and display them on your screen.
\item Edit the \texttt{SConstruct} file to implement your processing strategy and to generate a seismic image. 
Make sure to select appropriate processing parameters.
\end{enumerate}

\lstset{language=python,numbers=left,numberstyle=\tiny,showstringspaces=false}
\lstinputlisting[frame=single]{gulf/SConstruct}

\end{enumerate}

\newpage

\section{Completing the assignment}

\begin{enumerate}
\item Change directory to \verb#hw3#.
\item Edit the file \texttt{paper.tex} in your favorite editor 
      and change the first line to have your name instead of Fermat's.
\item Run
\begin{verbatim}
sftour scons lock
\end{verbatim}
to update all figures.
\item Run
\begin{verbatim}
sftour scons -c
\end{verbatim}
to remove intermediate files.
\item Run
\begin{verbatim} 
  scons pdf
\end{verbatim}
  to create the final document.
\item Submit your result (file \texttt{paper.pdf}) on paper or by
  e-mail. 
\end{enumerate}
